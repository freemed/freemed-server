(function(a,b){if(typeof define==="function"&&define.amd){define("sifter",b)}else{if(typeof exports==="object"){module.exports=b()}else{a.Sifter=b()}}}(this,function(){var h=function(j,k){this.items=j;this.settings=k||{diacritics:true}};h.prototype.tokenize=function(m){m=b(String(m||"").toLowerCase());if(!m||!m.length){return[]}var j,q,l,k;var o=[];var p=m.split(/ +/);for(j=0,q=p.length;j<q;j++){l=e(p[j]);if(this.settings.diacritics){for(k in i){if(i.hasOwnProperty(k)){l=l.replace(new RegExp(k,"g"),i[k])}}}o.push({string:p[j],regex:new RegExp(l,"i")})}return o};h.prototype.iterator=function(j,l){var k;if(c(j)){k=Array.prototype.forEach||function(p){for(var m=0,o=this.length;m<o;m++){p(this[m],m,this)}}}else{k=function(n){for(var m in this){if(this.hasOwnProperty(m)){n(this[m],m,this)}}}}k.apply(j,[l])};h.prototype.getScoreFunction=function(q,r){var p,l,n,o,k;p=this;q=p.prepareSearch(q,r);n=q.tokens;l=q.options.fields;o=n.length;k=q.options.nesting;var m=function(t,s){var u,v;if(!t){return 0}t=String(t||"");v=t.search(s.regex);if(v===-1){return 0}u=s.string.length/t.length;if(v===0){u+=0.5}return u};var j=(function(){var s=l.length;if(!s){return function(){return 0}}if(s===1){return function(t,u){return m(a(u,l[0],k),t)}}return function(u,w){for(var t=0,v=0;t<s;t++){v+=m(a(w,l[t],k),u)}return v/s}})();if(!o){return function(){return 0}}if(o===1){return function(s){return j(n[0],s)}}if(q.options.conjunction==="and"){return function(u){var v;for(var s=0,t=0;s<o;s++){v=j(n[s],u);if(v<=0){return 0}t+=v}return t/o}}else{return function(u){for(var s=0,t=0;s<o;s++){t+=j(n[s],u)}return t/o}}};h.prototype.getSortFunction=function(v,w){var q,j,u,s,r,l,t,o,k,m,p;u=this;v=u.prepareSearch(v,w);p=(!v.query&&w.sort_empty)||w.sort;k=function(x,n){if(x==="$score"){return n.score}return a(u.items[n.id],x,w.nesting)};r=[];if(p){for(q=0,j=p.length;q<j;q++){if(v.query||p[q].field!=="$score"){r.push(p[q])}}}if(v.query){m=true;for(q=0,j=r.length;q<j;q++){if(r[q].field==="$score"){m=false;break}}if(m){r.unshift({field:"$score",direction:"desc"})}}else{for(q=0,j=r.length;q<j;q++){if(r[q].field==="$score"){r.splice(q,1);break}}}o=[];for(q=0,j=r.length;q<j;q++){o.push(r[q].direction==="desc"?-1:1)}l=r.length;if(!l){return null}else{if(l===1){s=r[0].field;t=o[0];return function(x,n){return t*f(k(s,x),k(s,n))}}else{return function(z,x){var B,n,y,A,C;for(B=0;B<l;B++){C=r[B].field;n=o[B]*f(k(C,z),k(C,x));if(n){return n}}return 0}}}};h.prototype.prepareSearch=function(m,j){if(typeof m==="object"){return m}j=d({},j);var l=j.fields;var n=j.sort;var k=j.sort_empty;if(l&&!c(l)){j.fields=[l]}if(n&&!c(n)){j.sort=[n]}if(k&&!c(k)){j.sort_empty=[k]}return{options:j,query:String(m||"").toLowerCase(),tokens:this.tokenize(m),total:0,items:[]}};h.prototype.search=function(m,r){var p=this,o,k,q,l;var j;var n;q=this.prepareSearch(m,r);r=q.options;m=q.query;n=r.score||p.getScoreFunction(q);if(m.length){p.iterator(p.items,function(s,t){k=n(s);if(r.filter===false||k>0){q.items.push({score:k,id:t})}})}else{p.iterator(p.items,function(s,t){q.items.push({score:1,id:t})})}j=p.getSortFunction(q,r);if(j){q.items.sort(j)}q.total=q.items.length;if(typeof r.limit==="number"){q.items=q.items.slice(0,r.limit)}return q};var f=function(k,j){if(typeof k==="number"&&typeof j==="number"){return k>j?1:(k<j?-1:0)}k=g(String(k||""));j=g(String(j||""));if(k>j){return 1}if(j>k){return -1}return 0};var d=function(l,j){var p,q,m,o;for(p=1,q=arguments.length;p<q;p++){o=arguments[p];if(!o){continue}for(m in o){if(o.hasOwnProperty(m)){l[m]=o[m]}}}return l};var a=function(m,j,k){if(!m||!j){return}if(!k){return m[j]}var l=j.split(".");while(l.length&&(m=m[l.shift()])){}return m};var b=function(j){return(j+"").replace(/^\s+|\s+$|/g,"")};var e=function(j){return(j+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")};var c=Array.isArray||(typeof $!=="undefined"&&$.isArray)||function(j){return Object.prototype.toString.call(j)==="[object Array]"};var i={a:"[aá¸€á¸Ä‚ÄƒÃ‚Ã¢ÇÇŽÈºâ±¥È¦È§áº áº¡Ã„Ã¤Ã€Ã ÃÃ¡Ä€ÄÃƒÃ£Ã…Ã¥Ä…Ä„ÃƒÄ…Ä„]",b:"[bâ¢Î²Î’Bà¸¿ðŒá›’]",c:"[cÄ†Ä‡ÄˆÄ‰ÄŒÄÄŠÄ‹CÌ„cÌ„Ã‡Ã§á¸ˆá¸‰È»È¼Æ‡ÆˆÉ•á´„ï¼£ï½ƒ]",d:"[dÄŽÄá¸Šá¸‹á¸á¸‘á¸Œá¸á¸’á¸“á¸Žá¸ÄÄ‘DÌ¦dÌ¦Æ‰É–ÆŠÉ—Æ‹ÆŒáµ­á¶á¶‘È¡á´…ï¼¤ï½„Ã°]",e:"[eÃ‰Ã©ÃˆÃ¨ÃŠÃªá¸˜á¸™ÄšÄ›Ä”Ä•áº¼áº½á¸šá¸›áººáº»Ä–Ä—Ã‹Ã«Ä’Ä“È¨È©Ä˜Ä™á¶’É†É‡È„È…áº¾áº¿á»€á»á»„á»…á»‚á»ƒá¸œá¸á¸–á¸—á¸”á¸•È†È‡áº¸áº¹á»†á»‡â±¸á´‡ï¼¥ï½…É˜ÇÆÆÎµ]",f:"[fÆ‘Æ’á¸žá¸Ÿ]",g:"[gÉ¢â‚²Ç¤Ç¥ÄœÄÄžÄŸÄ¢Ä£Æ“É Ä Ä¡]",h:"[hÄ¤Ä¥Ä¦Ä§á¸¨á¸©áº–áº–á¸¤á¸¥á¸¢á¸£É¦Ê°Ç¶Æ•]",i:"[iÃÃ­ÃŒÃ¬Ä¬Ä­ÃŽÃ®ÇÇÃÃ¯á¸®á¸¯Ä¨Ä©Ä®Ä¯ÄªÄ«á»ˆá»‰ÈˆÈ‰ÈŠÈ‹á»Šá»‹á¸¬á¸­Æ—É¨É¨Ì†áµ»á¶–Ä°iIÄ±Éªï¼©ï½‰]",j:"[jÈ·Ä´ÄµÉˆÉ‰ÊÉŸÊ²]",k:"[kÆ˜Æ™ê€êá¸°á¸±Ç¨Ç©á¸²á¸³á¸´á¸µÎºÏ°â‚­]",l:"[lÅÅ‚Ä½Ä¾Ä»Ä¼Ä¹Äºá¸¶á¸·á¸¸á¸¹á¸¼á¸½á¸ºá¸»Ä¿Å€È½Æšâ± â±¡â±¢É«É¬á¶…É­È´ÊŸï¼¬ï½Œ]",n:"[nÅƒÅ„Ç¸Ç¹Å‡ÅˆÃ‘Ã±á¹„á¹…Å…Å†á¹†á¹‡á¹Šá¹‹á¹ˆá¹‰NÌˆnÌˆÆÉ²È Æžáµ°á¶‡É³ÈµÉ´ï¼®ï½ŽÅŠÅ‹]",o:"[oÃ˜Ã¸Ã–Ã¶Ã“Ã³Ã’Ã²Ã”Ã´Ç‘Ç’ÅÅ‘ÅŽÅÈ®È¯á»Œá»ÆŸÉµÆ Æ¡á»Žá»ÅŒÅÃ•ÃµÇªÇ«ÈŒÈÕ•Ö…]",p:"[pá¹”á¹•á¹–á¹—â±£áµ½Æ¤Æ¥áµ±]",q:"[qê–ê—Ê ÉŠÉ‹ê˜ê™qÌƒ]",r:"[rÅ”Å•ÉŒÉÅ˜Å™Å–Å—á¹˜á¹™ÈÈ‘È’È“á¹šá¹›â±¤É½]",s:"[sÅšÅ›á¹ á¹¡á¹¢á¹£êž¨êž©ÅœÅÅ Å¡ÅžÅŸÈ˜È™SÌˆsÌˆ]",t:"[tÅ¤Å¥á¹ªá¹«Å¢Å£á¹¬á¹­Æ®ÊˆÈšÈ›á¹°á¹±á¹®á¹¯Æ¬Æ­]",u:"[uÅ¬Å­É„Ê‰á»¤á»¥ÃœÃ¼ÃšÃºÃ™Ã¹Ã›Ã»Ç“Ç”Å°Å±Å¬Å­Æ¯Æ°á»¦á»§ÅªÅ«Å¨Å©Å²Å³È”È•âˆª]",v:"[vá¹¼á¹½á¹¾á¹¿Æ²Ê‹êžêŸâ±±Ê‹]",w:"[wáº‚áºƒáº€áºÅ´Åµáº„áº…áº†áº‡áºˆáº‰]",x:"[xáºŒáºáºŠáº‹Ï‡]",y:"[yÃÃ½á»²á»³Å¶Å·Å¸Ã¿á»¸á»¹áºŽáºá»´á»µÉŽÉÆ³Æ´]",z:"[zÅ¹Åºáºáº‘Å½Å¾Å»Å¼áº’áº“áº”áº•ÆµÆ¶]"};var g=(function(){var o,r,j,m;var l="";var q={};for(j in i){if(i.hasOwnProperty(j)){m=i[j].substring(2,i[j].length-1);l+=m;for(o=0,r=m.length;o<r;o++){q[m.charAt(o)]=j}}}var p=new RegExp("["+l+"]","g");return function(k){return k.replace(p,function(n){return q[n]}).toLowerCase()}})();return h}));(function(a,b){if(typeof define==="function"&&define.amd){define("microplugin",b)}else{if(typeof exports==="object"){module.exports=b()}else{a.MicroPlugin=b()}}}(this,function(){var a={};a.mixin=function(c){c.plugins={};c.prototype.initializePlugins=function(e){var h,j,g;var f=this;var d=[];f.plugins={names:[],settings:{},requested:{},loaded:{}};if(b.isArray(e)){for(h=0,j=e.length;h<j;h++){if(typeof e[h]==="string"){d.push(e[h])}else{f.plugins.settings[e[h].name]=e[h].options;d.push(e[h].name)}}}else{if(e){for(g in e){if(e.hasOwnProperty(g)){f.plugins.settings[g]=e[g];d.push(g)}}}}while(d.length){f.require(d.shift())}};c.prototype.loadPlugin=function(f){var e=this;var d=e.plugins;var g=c.plugins[f];if(!c.plugins.hasOwnProperty(f)){throw new Error('Unable to find "'+f+'" plugin')}d.requested[f]=true;d.loaded[f]=g.fn.apply(e,[e.plugins.settings[f]||{}]);d.names.push(f)};c.prototype.require=function(f){var e=this;var d=e.plugins;if(!e.plugins.loaded.hasOwnProperty(f)){if(d.requested[f]){throw new Error('Plugin has circular dependency ("'+f+'")')}e.loadPlugin(f)}return d.loaded[f]};c.define=function(d,e){c.plugins[d]={name:d,fn:e}}};var b={isArray:Array.isArray||function(c){return Object.prototype.toString.call(c)==="[object Array]"}};return a}));(function(a,b){if(typeof define==="function"&&define.amd){define("selectize",["jquery","sifter","microplugin"],b)}else{if(typeof exports==="object"){module.exports=b(require("jquery"),require("sifter"),require("microplugin"))}else{a.Selectize=b(a.jQuery,a.Sifter,a.MicroPlugin)}}}(this,function(u,l,h){var L=function(O,R){if(typeof R==="string"&&!R.length){return}var Q=(typeof R==="string")?new RegExp(R,"i"):R;var P=function(U){var aa=0;if(U.nodeType===3){var Z=U.data.search(Q);if(Z>=0&&U.data.length>0){var Y=U.data.match(Q);var X=document.createElement("span");X.className="highlight";var V=U.splitText(Z);var S=V.splitText(Y[0].length);var T=V.cloneNode(true);X.appendChild(T);V.parentNode.replaceChild(X,V);aa=1}}else{if(U.nodeType===1&&U.childNodes&&!/(script|style)/i.test(U.tagName)){for(var W=0;W<U.childNodes.length;++W){W+=P(U.childNodes[W])}}}return aa};return O.each(function(){P(this)})};var F=function(){};F.prototype={on:function(P,O){this._events=this._events||{};this._events[P]=this._events[P]||[];this._events[P].push(O)},off:function(P,O){var Q=arguments.length;if(Q===0){return delete this._events}if(Q===1){return delete this._events[P]}this._events=this._events||{};if(P in this._events===false){return}this._events[P].splice(this._events[P].indexOf(O),1)},trigger:function(P){this._events=this._events||{};if(P in this._events===false){return}for(var O=0;O<this._events[P].length;O++){this._events[P][O].apply(this,Array.prototype.slice.call(arguments,1))}}};F.mixin=function(O){var Q=["on","off","trigger"];for(var P=0;P<Q.length;P++){O.prototype[Q[P]]=F.prototype[Q[P]]}};var b=/Mac/.test(navigator.userAgent);var H=65;var M=188;var y=13;var v=27;var o=37;var G=38;var w=80;var s=39;var t=40;var A=78;var n=8;var p=46;var i=16;var I=b?91:17;var d=b?18:17;var E=9;var j=1;var g=2;var B=!/android/i.test(window.navigator.userAgent)&&!!document.createElement("form").validity;var N=function(O){return typeof O!=="undefined"};var x=function(O){if(typeof O==="undefined"||O===null){return null}if(typeof O==="boolean"){return O?"1":"0"}return O+""};var C=function(O){return(O+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var e=function(O){return(O+"").replace(/\$/g,"$$$$")};var r={};r.before=function(O,R,Q){var P=O[R];O[R]=function(){Q.apply(O,arguments);return P.apply(O,arguments)}};r.after=function(O,R,Q){var P=O[R];O[R]=function(){var S=P.apply(O,arguments);Q.apply(O,arguments);return S}};var q=function(O){var P=false;return function(){if(P){return}P=true;O.apply(this,arguments)}};var f=function(P,O){var Q;return function(){var R=this;var S=arguments;window.clearTimeout(Q);Q=window.setTimeout(function(){P.apply(R,S)},O)}};var a=function(O,Q,S){var R;var P=O.trigger;var T={};O.trigger=function(){var U=arguments[0];if(Q.indexOf(U)!==-1){T[U]=arguments}else{return P.apply(O,arguments)}};S.apply(O,[]);O.trigger=P;for(R in T){if(T.hasOwnProperty(R)){P.apply(O,T[R])}}};var z=function(R,Q,O,P){R.on(Q,O,function(S){var T=S.target;while(T&&T.parentNode!==R[0]){T=T.parentNode}S.currentTarget=T;return P.apply(this,[S])})};var k=function(Q){var P={};if("selectionStart" in Q){P.start=Q.selectionStart;P.length=Q.selectionEnd-P.start}else{if(document.selection){Q.focus();var R=document.selection.createRange();var O=document.selection.createRange().text.length;R.moveStart("character",-Q.value.length);P.start=R.text.length-O;P.length=O}}return P};var m=function(R,S,P){var O,T,Q={};if(P){for(O=0,T=P.length;O<T;O++){Q[P[O]]=R.css(P[O])}}else{Q=R.css()}S.css(Q)};var J=function(R,Q){if(!R){return 0}var P=u("<test>").css({position:"absolute",top:-99999,left:-99999,width:"auto",padding:0,whiteSpace:"pre"}).text(R).appendTo("body");m(Q,P,["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"]);var O=P.width();P.remove();return O};var K=function(Q){var O=null;var P=function(U,aa){var Y,Z,V,X,R;var S,T,W;U=U||window.event||{};aa=aa||{};if(U.metaKey||U.altKey){return}if(!aa.force&&Q.data("grow")===false){return}Y=Q.val();if(U.type&&U.type.toLowerCase()==="keydown"){Z=U.keyCode;V=((Z>=97&&Z<=122)||(Z>=65&&Z<=90)||(Z>=48&&Z<=57)||Z===32);if(Z===p||Z===n){W=k(Q[0]);if(W.length){Y=Y.substring(0,W.start)+Y.substring(W.start+W.length)}else{if(Z===n&&W.start){Y=Y.substring(0,W.start-1)+Y.substring(W.start+1)}else{if(Z===p&&typeof W.start!=="undefined"){Y=Y.substring(0,W.start)+Y.substring(W.start+1)}}}}else{if(V){S=U.shiftKey;T=String.fromCharCode(U.keyCode);if(S){T=T.toUpperCase()}else{T=T.toLowerCase()}Y+=T}}}X=Q.attr("placeholder");if(!Y&&X){Y=X}R=J(Y,Q)+4;if(R!==O){O=R;Q.width(R);Q.triggerHandler("resize")}};Q.on("keydown keyup update blur",P);P()};var D=function(P){var O=document.createElement("div");O.appendChild(P.cloneNode(true));return O.innerHTML};var c=function(T,Q){var V,R,O,P,U,W=this;U=T[0];U.selectize=W;var S=window.getComputedStyle&&window.getComputedStyle(U,null);P=S?S.getPropertyValue("direction"):U.currentStyle&&U.currentStyle.direction;P=P||T.parents("[dir]:first").attr("dir")||"";u.extend(W,{order:0,settings:Q,$input:T,tabIndex:T.attr("tabindex")||"",tagType:U.tagName.toLowerCase()==="select"?j:g,rtl:/rtl/i.test(P),eventNS:".selectize"+(++c.count),highlightedValue:null,isOpen:false,isDisabled:false,isRequired:T.is("[required]"),isInvalid:false,isLocked:false,isFocused:false,isInputHidden:false,isSetup:false,isShiftDown:false,isCmdDown:false,isCtrlDown:false,ignoreFocus:false,ignoreBlur:false,ignoreHover:false,hasOptions:false,currentResults:null,lastValue:"",caretPos:0,loading:0,loadedSearches:{},$activeOption:null,$activeItems:[],optgroups:{},options:{},userOptions:{},items:[],renderCache:{},onSearchChange:Q.loadThrottle===null?W.onSearchChange:f(W.onSearchChange,Q.loadThrottle)});W.sifter=new l(this.options,{diacritics:Q.diacritics});if(W.settings.options){for(R=0,O=W.settings.options.length;R<O;R++){W.registerOption(W.settings.options[R])}delete W.settings.options}if(W.settings.optgroups){for(R=0,O=W.settings.optgroups.length;R<O;R++){W.registerOptionGroup(W.settings.optgroups[R])}delete W.settings.optgroups}W.settings.mode=W.settings.mode||(W.settings.maxItems===1?"single":"multi");if(typeof W.settings.hideSelected!=="boolean"){W.settings.hideSelected=W.settings.mode==="multi"}W.initializePlugins(W.settings.plugins);W.setupCallbacks();W.setupTemplates();W.setup()};F.mixin(c);h.mixin(c);u.extend(c.prototype,{setup:function(){var U=this;var aa=U.settings;var X=U.eventNS;var T=u(window);var ae=u(document);var Q=U.$input;var Y;var ac;var P;var R;var V;var Z;var af;var S;var ad;var ab;var W;af=U.settings.mode;ab=Q.attr("class")||"";Y=u("<div>").addClass(aa.wrapperClass).addClass(ab).addClass(af);ac=u("<div>").addClass(aa.inputClass).addClass("items").appendTo(Y);P=u('<input type="text" autocomplete="off" />').appendTo(ac).attr("tabindex",Q.is(":disabled")?"-1":U.tabIndex);Z=u(aa.dropdownParent||Y);R=u("<div>").addClass(aa.dropdownClass).addClass(af).hide().appendTo(Z);V=u("<div>").addClass(aa.dropdownContentClass).appendTo(R);if(U.settings.copyClassesToDropdown){R.addClass(ab)}Y.css({width:Q[0].style.width});if(U.plugins.names.length){W="plugin-"+U.plugins.names.join(" plugin-");Y.addClass(W);R.addClass(W)}if((aa.maxItems===null||aa.maxItems>1)&&U.tagType===j){Q.attr("multiple","multiple")}if(U.settings.placeholder){P.attr("placeholder",aa.placeholder)}if(!U.settings.splitOn&&U.settings.delimiter){var O=U.settings.delimiter.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");U.settings.splitOn=new RegExp("\\s*"+O+"+\\s*")}if(Q.attr("autocorrect")){P.attr("autocorrect",Q.attr("autocorrect"))}if(Q.attr("autocapitalize")){P.attr("autocapitalize",Q.attr("autocapitalize"))}U.$wrapper=Y;U.$control=ac;U.$control_input=P;U.$dropdown=R;U.$dropdown_content=V;R.on("mouseenter","[data-selectable]",function(){return U.onOptionHover.apply(U,arguments)});R.on("mousedown click","[data-selectable]",function(){return U.onOptionSelect.apply(U,arguments)});z(ac,"mousedown","*:not(input)",function(){return U.onItemSelect.apply(U,arguments)});K(P);ac.on({mousedown:function(){return U.onMouseDown.apply(U,arguments)},click:function(){return U.onClick.apply(U,arguments)}});P.on({mousedown:function(ag){ag.stopPropagation()},keydown:function(){return U.onKeyDown.apply(U,arguments)},keyup:function(){return U.onKeyUp.apply(U,arguments)},keypress:function(){return U.onKeyPress.apply(U,arguments)},resize:function(){U.positionDropdown.apply(U,[])},blur:function(){return U.onBlur.apply(U,arguments)},focus:function(){U.ignoreBlur=false;return U.onFocus.apply(U,arguments)},paste:function(){return U.onPaste.apply(U,arguments)}});ae.on("keydown"+X,function(ag){U.isCmdDown=ag[b?"metaKey":"ctrlKey"];U.isCtrlDown=ag[b?"altKey":"ctrlKey"];U.isShiftDown=ag.shiftKey});ae.on("keyup"+X,function(ag){if(ag.keyCode===d){U.isCtrlDown=false}if(ag.keyCode===i){U.isShiftDown=false}if(ag.keyCode===I){U.isCmdDown=false}});ae.on("mousedown"+X,function(ag){if(U.isFocused){if(ag.target===U.$dropdown[0]||ag.target.parentNode===U.$dropdown[0]){return false}if(!U.$control.has(ag.target).length&&ag.target!==U.$control[0]){U.blur(ag.target)}}});T.on(["scroll"+X,"resize"+X].join(" "),function(){if(U.isOpen){U.positionDropdown.apply(U,arguments)}});T.on("mousemove"+X,function(){U.ignoreHover=false});this.revertSettings={$children:Q.children().detach(),tabindex:Q.attr("tabindex")};Q.attr("tabindex",-1).hide().after(U.$wrapper);if(u.isArray(aa.items)){U.setValue(aa.items);delete aa.items}if(B){Q.on("invalid"+X,function(ag){ag.preventDefault();U.isInvalid=true;U.refreshState()})}U.updateOriginalInput();U.refreshItems();U.refreshState();U.updatePlaceholder();U.isSetup=true;if(Q.is(":disabled")){U.disable()}U.on("change",this.onChange);Q.data("selectize",U);Q.addClass("selectized");U.trigger("initialize");if(aa.preload===true){U.onSearchChange("")}},setupTemplates:function(){var P=this;var O=P.settings.labelField;var Q=P.settings.optgroupLabelField;var R={optgroup:function(S){return'<div class="optgroup">'+S.html+"</div>"},optgroup_header:function(T,S){return'<div class="optgroup-header">'+S(T[Q])+"</div>"},option:function(T,S){return'<div class="option">'+S(T[O])+"</div>"},item:function(T,S){return'<div class="item">'+S(T[O])+"</div>"},option_create:function(T,S){return'<div class="create">Add <strong>'+S(T.input)+"</strong>&hellip;</div>"}};P.settings.render=u.extend({},R,P.settings.render)},setupCallbacks:function(){var O,P,Q={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(O in Q){if(Q.hasOwnProperty(O)){P=this.settings[Q[O]];if(P){this.on(O,P)}}}},onClick:function(P){var O=this;if(!O.isFocused){O.focus();P.preventDefault()}},onMouseDown:function(R){var P=this;var Q=R.isDefaultPrevented();var O=u(R.target);if(P.isFocused){if(R.target!==P.$control_input[0]){if(P.settings.mode==="single"){P.isOpen?P.close():P.open()}else{if(!Q){P.setActiveItem(null)}}return false}}else{if(!Q){window.setTimeout(function(){P.focus()},0)}}},onChange:function(){this.$input.trigger("change")},onPaste:function(P){var O=this;if(O.isFull()||O.isInputHidden||O.isLocked){P.preventDefault()}else{if(O.settings.splitOn){setTimeout(function(){var Q=u.trim(O.$control_input.val()||"").split(O.settings.splitOn);for(var R=0,S=Q.length;R<S;R++){O.createItem(Q[R])}},0)}}},onKeyPress:function(P){if(this.isLocked){return P&&P.preventDefault()}var O=String.fromCharCode(P.keyCode||P.which);if(this.settings.create&&this.settings.mode==="multi"&&O===this.settings.delimiter){this.createItem();P.preventDefault();return false}},onKeyDown:function(S){var R=S.target===this.$control_input[0];var Q=this;if(Q.isLocked){if(S.keyCode!==E){S.preventDefault()}return}switch(S.keyCode){case H:if(Q.isCmdDown){Q.selectAll();return}break;case v:if(Q.isOpen){S.preventDefault();S.stopPropagation();Q.close()}return;case A:if(!S.ctrlKey||S.altKey){break}case t:if(!Q.isOpen&&Q.hasOptions){Q.open()}else{if(Q.$activeOption){Q.ignoreHover=true;var O=Q.getAdjacentOption(Q.$activeOption,1);if(O.length){Q.setActiveOption(O,true,true)}}}S.preventDefault();return;case w:if(!S.ctrlKey||S.altKey){break}case G:if(Q.$activeOption){Q.ignoreHover=true;var P=Q.getAdjacentOption(Q.$activeOption,-1);if(P.length){Q.setActiveOption(P,true,true)}}S.preventDefault();return;case y:if(Q.isOpen&&Q.$activeOption){Q.onOptionSelect({currentTarget:Q.$activeOption});S.preventDefault()}return;case o:Q.advanceSelection(-1,S);return;case s:Q.advanceSelection(1,S);return;case E:if(Q.settings.selectOnTab&&Q.isOpen&&Q.$activeOption){Q.onOptionSelect({currentTarget:Q.$activeOption});if(!Q.isFull()){S.preventDefault()}}if(Q.settings.create&&Q.createItem()){S.preventDefault()}return;case n:case p:Q.deleteSelection(S);return}if((Q.isFull()||Q.isInputHidden)&&!(b?S.metaKey:S.ctrlKey)){S.preventDefault();return}},onKeyUp:function(Q){var O=this;if(O.isLocked){return Q&&Q.preventDefault()}var P=O.$control_input.val()||"";if(O.lastValue!==P){O.lastValue=P;O.onSearchChange(P);O.refreshOptions();O.trigger("type",P)}},onSearchChange:function(Q){var O=this;var P=O.settings.load;if(!P){return}if(O.loadedSearches.hasOwnProperty(Q)){return}O.loadedSearches[Q]=true;O.load(function(R){P.apply(O,[Q,R])})},onFocus:function(Q){var O=this;var P=O.isFocused;if(O.isDisabled){O.blur();Q&&Q.preventDefault();return false}if(O.ignoreFocus){return}O.isFocused=true;if(O.settings.preload==="focus"){O.onSearchChange("")}if(!P){O.trigger("focus")}if(!O.$activeItems.length){O.showInput();O.setActiveItem(null);O.refreshOptions(!!O.settings.openOnFocus)}O.refreshState()},onBlur:function(R,P){var O=this;if(!O.isFocused){return}O.isFocused=false;if(O.ignoreFocus){return}else{if(!O.ignoreBlur&&document.activeElement===O.$dropdown_content[0]){O.ignoreBlur=true;O.onFocus(R);return}}var Q=function(){O.close();O.setTextboxValue("");O.setActiveItem(null);O.setActiveOption(null);O.setCaret(O.items.length);O.refreshState();P&&P.focus();O.ignoreFocus=false;O.trigger("blur")};O.ignoreFocus=true;if(O.settings.create&&O.settings.createOnBlur){O.createItem(null,false,Q)}else{Q()}},onOptionHover:function(O){if(this.ignoreHover){return}this.setActiveOption(O.currentTarget,false)},onOptionSelect:function(S){var Q,O,R,P=this;if(S.preventDefault){S.preventDefault();S.stopPropagation()}O=u(S.currentTarget);if(O.hasClass("create")){P.createItem(null,function(){if(P.settings.closeAfterSelect){P.close()}})}else{Q=O.attr("data-value");if(typeof Q!=="undefined"){P.lastQuery=null;P.setTextboxValue("");P.addItem(Q);if(P.settings.closeAfterSelect){P.close()}else{if(!P.settings.hideSelected&&S.type&&/mouse/.test(S.type)){P.setActiveOption(P.getOption(Q))}}}}},onItemSelect:function(P){var O=this;if(O.isLocked){return}if(O.settings.mode==="multi"){P.preventDefault();O.setActiveItem(P.currentTarget,P)}},load:function(P){var O=this;var Q=O.$wrapper.addClass(O.settings.loadingClass);O.loading++;P.apply(O,[function(R){O.loading=Math.max(O.loading-1,0);if(R&&R.length){O.addOption(R);O.refreshOptions(O.isFocused&&!O.isInputHidden)}if(!O.loading){Q.removeClass(O.settings.loadingClass)}O.trigger("load",R)}])},setTextboxValue:function(O){var Q=this.$control_input;var P=Q.val()!==O;if(P){Q.val(O).triggerHandler("update");this.lastValue=O}},getValue:function(){if(this.tagType===j&&this.$input.attr("multiple")){return this.items}else{return this.items.join(this.settings.delimiter)}},setValue:function(Q,O){var P=O?[]:["change"];a(this,P,function(){this.clear(O);this.addItems(Q,O)})},setActiveItem:function(V,T){var Y=this;var S;var R,W,O,Q,X,P;var U;if(Y.settings.mode==="single"){return}V=u(V);if(!V.length){u(Y.$activeItems).removeClass("active");Y.$activeItems=[];if(Y.isFocused){Y.showInput()}return}S=T&&T.type.toLowerCase();if(S==="mousedown"&&Y.isShiftDown&&Y.$activeItems.length){U=Y.$control.children(".active:last");O=Array.prototype.indexOf.apply(Y.$control[0].childNodes,[U[0]]);Q=Array.prototype.indexOf.apply(Y.$control[0].childNodes,[V[0]]);if(O>Q){P=O;O=Q;Q=P}for(R=O;R<=Q;R++){X=Y.$control[0].childNodes[R];if(Y.$activeItems.indexOf(X)===-1){u(X).addClass("active");Y.$activeItems.push(X)}}T.preventDefault()}else{if((S==="mousedown"&&Y.isCtrlDown)||(S==="keydown"&&this.isShiftDown)){if(V.hasClass("active")){W=Y.$activeItems.indexOf(V[0]);Y.$activeItems.splice(W,1);V.removeClass("active")}else{Y.$activeItems.push(V.addClass("active")[0])}}else{u(Y.$activeItems).removeClass("active");Y.$activeItems=[V.addClass("active")[0]]}}Y.hideInput();if(!this.isFocused){Y.focus()}},setActiveOption:function(O,U,Q){var P,V,T;var S,R;var W=this;if(W.$activeOption){W.$activeOption.removeClass("active")}W.$activeOption=null;O=u(O);if(!O.length){return}W.$activeOption=O.addClass("active");if(U||!N(U)){P=W.$dropdown_content.height();V=W.$activeOption.outerHeight(true);U=W.$dropdown_content.scrollTop()||0;T=W.$activeOption.offset().top-W.$dropdown_content.offset().top+U;S=T;R=T-P+V;if(T+V>P+U){W.$dropdown_content.stop().animate({scrollTop:R},Q?W.settings.scrollDuration:0)}else{if(T<U){W.$dropdown_content.stop().animate({scrollTop:S},Q?W.settings.scrollDuration:0)}}}},selectAll:function(){var O=this;if(O.settings.mode==="single"){return}O.$activeItems=Array.prototype.slice.apply(O.$control.children(":not(input)").addClass("active"));if(O.$activeItems.length){O.hideInput();O.close()}O.focus()},hideInput:function(){var O=this;O.setTextboxValue("");O.$control_input.css({opacity:0,position:"absolute",left:O.rtl?10000:-10000});O.isInputHidden=true},showInput:function(){this.$control_input.css({opacity:1,position:"relative",left:0});this.isInputHidden=false},focus:function(){var O=this;if(O.isDisabled){return}O.ignoreFocus=true;O.$control_input[0].focus();window.setTimeout(function(){O.ignoreFocus=false;O.onFocus()},0)},blur:function(O){this.$control_input[0].blur();this.onBlur(null,O)},getScoreFunction:function(O){return this.sifter.getScoreFunction(O,this.getSearchOptions())},getSearchOptions:function(){var P=this.settings;var O=P.sortField;if(typeof O==="string"){O=[{field:O}]}return{fields:P.searchField,conjunction:P.searchConjunction,sort:O}},search:function(S){var R,T,O,W,Q;var U=this;var P=U.settings;var V=this.getSearchOptions();if(P.score){Q=U.settings.score.apply(this,[S]);if(typeof Q!=="function"){throw new Error('Selectize "score" setting must be a function that returns a function')}}if(S!==U.lastQuery){U.lastQuery=S;W=U.sifter.search(S,u.extend(V,{score:Q}));U.currentResults=W}else{W=u.extend(true,{},U.currentResults)}if(P.hideSelected){for(R=W.items.length-1;R>=0;R--){if(U.items.indexOf(x(W.items[R].id))!==-1){W.items.splice(R,1)}}}return W},refreshOptions:function(Y){var af,ae,ad,ab,ai,O,U,ag,Q,ac,S,ah,T;var R,X,Z;if(typeof Y==="undefined"){Y=true}var W=this;var P=u.trim(W.$control_input.val());var aa=W.search(P);var V=W.$dropdown_content;var aj=W.$activeOption&&x(W.$activeOption.attr("data-value"));ab=aa.items.length;if(typeof W.settings.maxOptions==="number"){ab=Math.min(ab,W.settings.maxOptions)}ai={};O=[];for(af=0;af<ab;af++){U=W.options[aa.items[af].id];ag=W.render("option",U);Q=U[W.settings.optgroupField]||"";ac=u.isArray(Q)?Q:[Q];for(ae=0,ad=ac&&ac.length;ae<ad;ae++){Q=ac[ae];if(!W.optgroups.hasOwnProperty(Q)){Q=""}if(!ai.hasOwnProperty(Q)){ai[Q]=document.createDocumentFragment();O.push(Q)}ai[Q].appendChild(ag)}}if(this.settings.lockOptgroupOrder){O.sort(function(al,ak){var am=W.optgroups[al].$order||0;var an=W.optgroups[ak].$order||0;return am-an})}S=document.createDocumentFragment();for(af=0,ab=O.length;af<ab;af++){Q=O[af];if(W.optgroups.hasOwnProperty(Q)&&ai[Q].childNodes.length){ah=document.createDocumentFragment();ah.appendChild(W.render("optgroup_header",W.optgroups[Q]));ah.appendChild(ai[Q]);S.appendChild(W.render("optgroup",u.extend({},W.optgroups[Q],{html:D(ah),dom:ah})))}else{S.appendChild(ai[Q])}}V.html(S);if(W.settings.highlight&&aa.query.length&&aa.tokens.length){for(af=0,ab=aa.tokens.length;af<ab;af++){L(V,aa.tokens[af].regex)}}if(!W.settings.hideSelected){for(af=0,ab=W.items.length;af<ab;af++){W.getOption(W.items[af]).addClass("selected")}}T=W.canCreate(P);if(T){V.prepend(W.render("option_create",{input:P}));Z=u(V[0].childNodes[0])}W.hasOptions=aa.items.length>0||T;if(W.hasOptions){if(aa.items.length>0){X=aj&&W.getOption(aj);if(X&&X.length){R=X}else{if(W.settings.mode==="single"&&W.items.length){R=W.getOption(W.items[0])}}if(!R||!R.length){if(Z&&!W.settings.addPrecedence){R=W.getAdjacentOption(Z,1)}else{R=V.find("[data-selectable]:first")}}}else{R=Z}W.setActiveOption(R);if(Y&&!W.isOpen){W.open()}}else{W.setActiveOption(null);if(Y&&W.isOpen){W.close()}}},addOption:function(R){var P,S,Q,O=this;if(u.isArray(R)){for(P=0,S=R.length;P<S;P++){O.addOption(R[P])}return}if(Q=O.registerOption(R)){O.userOptions[Q]=true;O.lastQuery=null;O.trigger("option_add",Q,R)}},registerOption:function(P){var O=x(P[this.settings.valueField]);if(typeof O==="undefined"||O===null||this.options.hasOwnProperty(O)){return false}P.$order=P.$order||++this.order;this.options[O]=P;return O},registerOptionGroup:function(P){var O=x(P[this.settings.optgroupValueField]);if(!O){return false}P.$order=P.$order||++this.order;this.optgroups[O]=P;return O},addOptionGroup:function(P,O){O[this.settings.optgroupValueField]=P;if(P=this.registerOptionGroup(O)){this.trigger("optgroup_add",P,O)}},removeOptionGroup:function(O){if(this.optgroups.hasOwnProperty(O)){delete this.optgroups[O];this.renderCache={};this.trigger("optgroup_remove",O)}},clearOptionGroups:function(){this.optgroups={};this.renderCache={};this.trigger("optgroup_clear")},updateOption:function(V,T){var X=this;var W,O;var Q,R,U,P,S;V=x(V);Q=x(T[X.settings.valueField]);if(V===null){return}if(!X.options.hasOwnProperty(V)){return}if(typeof Q!=="string"){throw new Error("Value must be set in option data")}S=X.options[V].$order;if(Q!==V){delete X.options[V];R=X.items.indexOf(V);if(R!==-1){X.items.splice(R,1,Q)}}T.$order=T.$order||S;X.options[Q]=T;U=X.renderCache.item;P=X.renderCache.option;if(U){delete U[V];delete U[Q]}if(P){delete P[V];delete P[Q]}if(X.items.indexOf(Q)!==-1){W=X.getItem(V);O=u(X.render("item",T));if(W.hasClass("active")){O.addClass("active")}W.replaceWith(O)}X.lastQuery=null;if(X.isOpen){X.refreshOptions(false)}},removeOption:function(S,Q){var P=this;S=x(S);var O=P.renderCache.item;var R=P.renderCache.option;if(O){delete O[S]}if(R){delete R[S]}delete P.userOptions[S];delete P.options[S];P.lastQuery=null;P.trigger("option_remove",S);P.removeItem(S,Q)},clearOptions:function(){var O=this;O.loadedSearches={};O.userOptions={};O.renderCache={};O.options=O.sifter.items={};O.lastQuery=null;O.trigger("option_clear");O.clear()},getOption:function(O){return this.getElementWithValue(O,this.$dropdown_content.find("[data-selectable]"))},getAdjacentOption:function(R,Q){var O=this.$dropdown.find("[data-selectable]");var P=O.index(R)+Q;return P>=0&&P<O.length?O.eq(P):u()},getElementWithValue:function(Q,P){Q=x(Q);if(typeof Q!=="undefined"&&Q!==null){for(var O=0,R=P.length;O<R;O++){if(P[O].getAttribute("data-value")===Q){return u(P[O])}}}return u()},getItem:function(O){return this.getElementWithValue(O,this.$control.children())},addItems:function(Q,P){var O=u.isArray(Q)?Q:[Q];for(var R=0,S=O.length;R<S;R++){this.isPending=(R<S-1);this.addItem(O[R],P)}},addItem:function(Q,O){var P=O?[]:["change"];a(this,P,function(){var Y,S,W;var Z=this;var R=Z.settings.mode;var V,U,X,T;Q=x(Q);if(Z.items.indexOf(Q)!==-1){if(R==="single"){Z.close()}return}if(!Z.options.hasOwnProperty(Q)){return}if(R==="single"){Z.clear(O)}if(R==="multi"&&Z.isFull()){return}Y=u(Z.render("item",Z.options[Q]));T=Z.isFull();Z.items.splice(Z.caretPos,0,Q);Z.insertAtCaret(Y);if(!Z.isPending||(!T&&Z.isFull())){Z.refreshState()}if(Z.isSetup){W=Z.$dropdown_content.find("[data-selectable]");if(!Z.isPending){S=Z.getOption(Q);X=Z.getAdjacentOption(S,1).attr("data-value");Z.refreshOptions(Z.isFocused&&R!=="single");if(X){Z.setActiveOption(Z.getOption(X))}}if(!W.length||Z.isFull()){Z.close()}else{Z.positionDropdown()}Z.updatePlaceholder();Z.trigger("item_add",Q,Y);Z.updateOriginalInput({silent:O})}})},removeItem:function(T,R){var Q=this;var P,S,O;P=(T instanceof u)?T:Q.getItem(T);T=x(P.attr("data-value"));S=Q.items.indexOf(T);if(S!==-1){P.remove();if(P.hasClass("active")){O=Q.$activeItems.indexOf(P[0]);Q.$activeItems.splice(O,1)}Q.items.splice(S,1);Q.lastQuery=null;if(!Q.settings.persist&&Q.userOptions.hasOwnProperty(T)){Q.removeOption(T,R)}if(S<Q.caretPos){Q.setCaret(Q.caretPos-1)}Q.refreshState();Q.updatePlaceholder();Q.updateOriginalInput({silent:R});Q.positionDropdown();Q.trigger("item_remove",T,P)}},createItem:function(R,T){var Q=this;var U=Q.caretPos;R=R||u.trim(Q.$control_input.val()||"");var V=arguments[arguments.length-1];if(typeof V!=="function"){V=function(){}}if(typeof T!=="boolean"){T=true}if(!Q.canCreate(R)){V();return false}Q.lock();var O=(typeof Q.settings.create==="function")?this.settings.create:function(W){var X={};X[Q.settings.labelField]=W;X[Q.settings.valueField]=W;return X};var S=q(function(X){Q.unlock();if(!X||typeof X!=="object"){return V()}var W=x(X[Q.settings.valueField]);if(typeof W!=="string"){return V()}Q.setTextboxValue("");Q.addOption(X);Q.setCaret(U);Q.addItem(W);Q.refreshOptions(T&&Q.settings.mode!=="single");V(X)});var P=O.apply(this,[R,S]);if(typeof P!=="undefined"){S(P)}return true},refreshItems:function(){this.lastQuery=null;if(this.isSetup){this.addItem(this.items)}this.refreshState();this.updateOriginalInput()},refreshState:function(){var P,O=this;if(O.isRequired){if(O.items.length){O.isInvalid=false}O.$control_input.prop("required",P)}O.refreshClasses()},refreshClasses:function(){var O=this;var P=O.isFull();var Q=O.isLocked;O.$wrapper.toggleClass("rtl",O.rtl);O.$control.toggleClass("focus",O.isFocused).toggleClass("disabled",O.isDisabled).toggleClass("required",O.isRequired).toggleClass("invalid",O.isInvalid).toggleClass("locked",Q).toggleClass("full",P).toggleClass("not-full",!P).toggleClass("input-active",O.isFocused&&!O.isInputHidden).toggleClass("dropdown-active",O.isOpen).toggleClass("has-options",!u.isEmptyObject(O.options)).toggleClass("has-items",O.items.length>0);O.$control_input.data("grow",!P&&!Q)},isFull:function(){return this.settings.maxItems!==null&&this.items.length>=this.settings.maxItems},updateOriginalInput:function(S){var R,T,Q,P,O=this;S=S||{};if(O.tagType===j){Q=[];for(R=0,T=O.items.length;R<T;R++){P=O.options[O.items[R]][O.settings.labelField]||"";Q.push('<option value="'+C(O.items[R])+'" selected="selected">'+C(P)+"</option>")}if(!Q.length&&!this.$input.attr("multiple")){Q.push('<option value="" selected="selected"></option>')}O.$input.html(Q.join(""))}else{O.$input.val(O.getValue());O.$input.attr("value",O.$input.val())}if(O.isSetup){if(!S.silent){O.trigger("change",O.$input.val())}}},updatePlaceholder:function(){if(!this.settings.placeholder){return}var O=this.$control_input;if(this.items.length){O.removeAttr("placeholder")}else{O.attr("placeholder",this.settings.placeholder)}O.triggerHandler("update",{force:true})},open:function(){var O=this;if(O.isLocked||O.isOpen||(O.settings.mode==="multi"&&O.isFull())){return}O.focus();O.isOpen=true;O.refreshState();O.$dropdown.css({visibility:"hidden",display:"block"});O.positionDropdown();O.$dropdown.css({visibility:"visible"});O.trigger("dropdown_open",O.$dropdown)},close:function(){var O=this;var P=O.isOpen;if(O.settings.mode==="single"&&O.items.length){O.hideInput()}O.isOpen=false;O.$dropdown.hide();O.setActiveOption(null);O.refreshState();if(P){O.trigger("dropdown_close",O.$dropdown)}},positionDropdown:function(){var O=this.$control;var P=this.settings.dropdownParent==="body"?O.offset():O.position();P.top+=O.outerHeight(true);this.$dropdown.css({width:O.outerWidth(),top:P.top,left:P.left})},clear:function(P){var O=this;if(!O.items.length){return}O.$control.children(":not(input)").remove();O.items=[];O.lastQuery=null;O.setCaret(0);O.setActiveItem(null);O.updatePlaceholder();O.updateOriginalInput({silent:P});O.refreshState();O.showInput();O.trigger("clear")},insertAtCaret:function(O){var P=Math.min(this.caretPos,this.items.length);if(P===0){this.$control.prepend(O)}else{u(this.$control[0].childNodes[P]).before(O)}this.setCaret(P+1)},deleteSelection:function(R){var P,O,V,W,X,T,S,U,Q;var Y=this;V=(R&&R.keyCode===n)?-1:1;W=k(Y.$control_input[0]);if(Y.$activeOption&&!Y.settings.hideSelected){S=Y.getAdjacentOption(Y.$activeOption,-1).attr("data-value")}X=[];if(Y.$activeItems.length){Q=Y.$control.children(".active:"+(V>0?"last":"first"));T=Y.$control.children(":not(input)").index(Q);if(V>0){T++}for(P=0,O=Y.$activeItems.length;P<O;P++){X.push(u(Y.$activeItems[P]).attr("data-value"))}if(R){R.preventDefault();R.stopPropagation()}}else{if((Y.isFocused||Y.settings.mode==="single")&&Y.items.length){if(V<0&&W.start===0&&W.length===0){X.push(Y.items[Y.caretPos-1])}else{if(V>0&&W.start===Y.$control_input.val().length){X.push(Y.items[Y.caretPos])}}}}if(!X.length||(typeof Y.settings.onDelete==="function"&&Y.settings.onDelete.apply(Y,[X])===false)){return false}if(typeof T!=="undefined"){Y.setCaret(T)}while(X.length){Y.removeItem(X.pop())}Y.showInput();Y.positionDropdown();Y.refreshOptions(true);if(S){U=Y.getOption(S);if(U.length){Y.setActiveOption(U)}}return true},advanceSelection:function(S,P){var Q,T,U,V,R,O;var W=this;if(S===0){return}if(W.rtl){S*=-1}Q=S>0?"last":"first";T=k(W.$control_input[0]);if(W.isFocused&&!W.isInputHidden){V=W.$control_input.val().length;R=S<0?T.start===0&&T.length===0:T.start===V;if(R&&!V){W.advanceCaret(S,P)}}else{O=W.$control.children(".active:"+Q);if(O.length){U=W.$control.children(":not(input)").index(O);W.setActiveItem(null);W.setCaret(S>0?U+1:U)}}},advanceCaret:function(S,R){var O=this,Q,P;if(S===0){return}Q=S>0?"next":"prev";if(O.isShiftDown){P=O.$control_input[Q]();if(P.length){O.hideInput();O.setActiveItem(P);R&&R.preventDefault()}}else{O.setCaret(O.caretPos+S)}},setCaret:function(R){var P=this;if(P.settings.mode==="single"){R=P.items.length}else{R=Math.max(0,Math.min(P.items.length,R))}if(!P.isPending){var Q,U,S,O,T;O=P.$control.children(":not(input)");for(Q=0,U=O.length;Q<U;Q++){T=u(O[Q]).detach();if(Q<R){P.$control_input.before(T)}else{P.$control.append(T)}}}P.caretPos=R},lock:function(){this.close();this.isLocked=true;this.refreshState()},unlock:function(){this.isLocked=false;this.refreshState()},disable:function(){var O=this;O.$input.prop("disabled",true);O.$control_input.prop("disabled",true).prop("tabindex",-1);O.isDisabled=true;O.lock()},enable:function(){var O=this;O.$input.prop("disabled",false);O.$control_input.prop("disabled",false).prop("tabindex",O.tabIndex);O.isDisabled=false;O.unlock()},destroy:function(){var O=this;var Q=O.eventNS;var P=O.revertSettings;O.trigger("destroy");O.off();O.$wrapper.remove();O.$dropdown.remove();O.$input.html("").append(P.$children).removeAttr("tabindex").removeClass("selectized").attr({tabindex:P.tabindex}).show();O.$control_input.removeData("grow");O.$input.removeData("selectize");u(window).off(Q);u(document).off(Q);u(document.body).off(Q);delete O.$input[0].selectize},render:function(W,Q){var U,P,T;var R="";var O=false;var V=this;var S=/^[\t \r\n]*<([a-z][a-z0-9\-_]*(?:\:[a-z][a-z0-9\-_]*)?)/i;if(W==="option"||W==="item"){U=x(Q[V.settings.valueField]);O=!!U}if(O){if(!N(V.renderCache[W])){V.renderCache[W]={}}if(V.renderCache[W].hasOwnProperty(U)){return V.renderCache[W][U]}}R=u(V.settings.render[W].apply(this,[Q,C]));if(W==="option"||W==="option_create"){R.attr("data-selectable","")}else{if(W==="optgroup"){P=Q[V.settings.optgroupValueField]||"";R.attr("data-group",P)}}if(W==="option"||W==="item"){R.attr("data-value",U||"")}if(O){V.renderCache[W][U]=R[0]}return R[0]},clearCache:function(O){var P=this;if(typeof O==="undefined"){P.renderCache={}}else{delete P.renderCache[O]}},canCreate:function(P){var O=this;if(!O.settings.create){return false}var Q=O.settings.createFilter;return P.length&&(typeof Q!=="function"||Q.apply(O,[P]))&&(typeof Q!=="string"||new RegExp(Q).test(P))&&(!(Q instanceof RegExp)||Q.test(P))}});c.count=0;c.defaults={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:true,diacritics:true,create:false,createOnBlur:false,createFilter:null,highlight:true,openOnFocus:true,maxOptions:1000,maxItems:null,hideSelected:null,addPrecedence:false,selectOnTab:false,preload:false,allowEmptyOption:false,closeAfterSelect:false,scrollDuration:60,loadThrottle:300,loadingClass:"loading",dataAttr:"data-data",optgroupField:"optgroup",valueField:"value",labelField:"text",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:false,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"selectize-control",inputClass:"selectize-input",dropdownClass:"selectize-dropdown",dropdownContentClass:"selectize-dropdown-content",dropdownParent:null,copyClassesToDropdown:true,render:{}};u.fn.selectize=function(U){var Q=u.fn.selectize.defaults;var P=u.extend({},Q,U);var R=P.dataAttr;var X=P.labelField;var Y=P.valueField;var W=P.optgroupField;var S=P.optgroupLabelField;var T=P.optgroupValueField;var O=function(ag,ae){var ab,af,Z,ac;var aa=ag.attr(R);if(!aa){var ad=u.trim(ag.val()||"");if(!P.allowEmptyOption&&!ad.length){return}Z=ad.split(P.delimiter);for(ab=0,af=Z.length;ab<af;ab++){ac={};ac[X]=Z[ab];ac[Y]=Z[ab];ae.options.push(ac)}ae.items=Z}else{ae.options=JSON.parse(aa);for(ab=0,af=ae.options.length;ab<af;ab++){ae.items.push(ae.options[ab][Y])}}};var V=function(ag,ae){var af,ab,ac,aj,ad=0;var ak=ae.options;var ai={};var Z=function(al){var am=R&&al.attr(R);if(typeof am==="string"&&am.length){return JSON.parse(am)}return null};var ah=function(ap,ao){ap=u(ap);var an=x(ap.val());if(!an&&!P.allowEmptyOption){return}if(ai.hasOwnProperty(an)){if(ao){var al=ai[an][W];if(!al){ai[an][W]=ao}else{if(!u.isArray(al)){ai[an][W]=[al,ao]}else{al.push(ao)}}}return}var am=Z(ap)||{};am[X]=am[X]||ap.text();am[Y]=am[Y]||an;am[W]=am[W]||ao;ai[an]=am;ak.push(am);if(ap.is(":selected")){ae.items.push(an)}};var aa=function(am){var ao,aq,ap,an,al;am=u(am);ap=am.attr("label");if(ap){an=Z(am)||{};an[S]=ap;an[T]=ap;ae.optgroups.push(an)}al=u("option",am);for(ao=0,aq=al.length;ao<aq;ao++){ah(al[ao],ap)}};ae.maxItems=ag.attr("multiple")?null:1;aj=ag.children();for(af=0,ab=aj.length;af<ab;af++){ac=aj[af].tagName.toLowerCase();if(ac==="optgroup"){aa(aj[af])}else{if(ac==="option"){ah(aj[af])}}}};return this.each(function(){if(this.selectize){return}var Z;var ad=u(this);var ac=this.tagName.toLowerCase();var ab=ad.attr("placeholder")||ad.attr("data-placeholder");if(!ab&&!P.allowEmptyOption){ab=ad.children('option[value=""]').text()}var aa={placeholder:ab,options:[],optgroups:[],items:[]};if(ac==="select"){V(ad,aa)}else{O(ad,aa)}Z=new c(ad,u.extend(true,{},Q,aa,U))})};u.fn.selectize.defaults=c.defaults;u.fn.selectize.support={validity:B};c.define("drag_drop",function(P){if(!u.fn.sortable){throw new Error('The "drag_drop" plugin requires jQuery UI "sortable".')}if(this.settings.mode!=="multi"){return}var O=this;O.lock=(function(){var Q=O.lock;return function(){var R=O.$control.data("sortable");if(R){R.disable()}return Q.apply(O,arguments)}})();O.unlock=(function(){var Q=O.unlock;return function(){var R=O.$control.data("sortable");if(R){R.enable()}return Q.apply(O,arguments)}})();O.setup=(function(){var Q=O.setup;return function(){Q.apply(this,arguments);var R=O.$control.sortable({items:"[data-value]",forcePlaceholderSize:true,disabled:O.isLocked,start:function(T,S){S.placeholder.css("width",S.helper.css("width"));R.css({overflow:"visible"})},stop:function(){R.css({overflow:"hidden"});var T=O.$activeItems?O.$activeItems.slice():null;var S=[];R.children("[data-value]").each(function(){S.push(u(this).attr("data-value"))});O.setValue(S);O.setActiveItem(T)}})}})()});c.define("dropdown_header",function(P){var O=this;P=u.extend({title:"Untitled",headerClass:"selectize-dropdown-header",titleRowClass:"selectize-dropdown-header-title",labelClass:"selectize-dropdown-header-label",closeClass:"selectize-dropdown-header-close",html:function(Q){return('<div class="'+Q.headerClass+'"><div class="'+Q.titleRowClass+'"><span class="'+Q.labelClass+'">'+Q.title+'</span><a href="javascript:void(0)" class="'+Q.closeClass+'">&times;</a></div></div>')}},P);O.setup=(function(){var Q=O.setup;return function(){Q.apply(O,arguments);O.$dropdown_header=u(P.html(P));O.$dropdown.prepend(O.$dropdown_header)}})()});c.define("optgroup_columns",function(Q){var P=this;Q=u.extend({equalizeWidth:true,equalizeHeight:true},Q);this.getAdjacentOption=function(V,U){var S=V.closest("[data-group]").find("[data-selectable]");var T=S.index(V)+U;return T>=0&&T<S.length?S.eq(T):u()};this.onKeyDown=(function(){var S=P.onKeyDown;return function(X){var V,W,T,U;if(this.isOpen&&(X.keyCode===o||X.keyCode===s)){P.ignoreHover=true;U=this.$activeOption.closest("[data-group]");V=U.find("[data-selectable]").index(this.$activeOption);if(X.keyCode===o){U=U.prev("[data-group]")}else{U=U.next("[data-group]")}T=U.find("[data-selectable]");W=T.eq(Math.min(T.length-1,V));if(W.length){this.setActiveOption(W)}return}return S.apply(this,arguments)}})();var O=function(){var U;var S=O.width;var T=document;if(typeof S==="undefined"){U=T.createElement("div");U.innerHTML='<div style="width:50px;height:50px;position:absolute;left:-50px;top:-50px;overflow:auto;"><div style="width:1px;height:100px;"></div></div>';U=U.firstChild;T.body.appendChild(U);S=O.width=U.offsetWidth-U.clientWidth;T.body.removeChild(U)}return S};var R=function(){var T,Y,S,U,X,W,V;V=u("[data-group]",P.$dropdown_content);Y=V.length;if(!Y||!P.$dropdown_content.width()){return}if(Q.equalizeHeight){S=0;for(T=0;T<Y;T++){S=Math.max(S,V.eq(T).height())}V.css({height:S})}if(Q.equalizeWidth){W=P.$dropdown_content.innerWidth()-O();U=Math.round(W/Y);V.css({width:U});if(Y>1){X=W-U*(Y-1);V.eq(Y-1).css({width:X})}}};if(Q.equalizeHeight||Q.equalizeWidth){r.after(this,"positionDropdown",R);r.after(this,"refreshOptions",R)}});c.define("remove_button",function(O){O=u.extend({label:"&times;",title:"Remove",className:"remove",append:true},O);var P=function(V,T){T.className="remove-single";var S=V;var U='<a href="javascript:void(0)" class="'+T.className+'" tabindex="-1" title="'+C(T.title)+'">'+T.label+"</a>";var R=function(W,X){return W+X};V.setup=(function(){var W=S.setup;return function(){if(T.append){var Z=u(S.$input.context).attr("id");var Y=u("#"+Z);var X=S.settings.render.item;S.settings.render.item=function(aa){return R(X.apply(V,arguments),U)}}W.apply(V,arguments);V.$control.on("click","."+T.className,function(aa){aa.preventDefault();if(S.isLocked){return}S.clear()})}})()};var Q=function(V,T){var S=V;var U='<a href="javascript:void(0)" class="'+T.className+'" tabindex="-1" title="'+C(T.title)+'">'+T.label+"</a>";var R=function(W,X){var Y=W.search(/(<\/[^>]+>\s*)$/);return W.substring(0,Y)+X+W.substring(Y)};V.setup=(function(){var W=S.setup;return function(){if(T.append){var X=S.settings.render.item;S.settings.render.item=function(Y){return R(X.apply(V,arguments),U)}}W.apply(V,arguments);V.$control.on("click","."+T.className,function(Z){Z.preventDefault();if(S.isLocked){return}var Y=u(Z.currentTarget).parent();S.setActiveItem(Y);if(S.deleteSelection()){S.setCaret(S.items.length)}})}})()};if(this.settings.mode==="single"){P(this,O);return}else{Q(this,O)}});c.define("restore_on_backspace",function(P){var O=this;P.text=P.text||function(Q){return Q[this.settings.labelField]};this.onKeyDown=(function(){var Q=O.onKeyDown;return function(T){var R,S;if(T.keyCode===n&&this.$control_input.val()===""&&!this.$activeItems.length){R=this.caretPos-1;if(R>=0&&R<this.items.length){S=this.options[this.items[R]];if(this.deleteSelection(T)){this.setTextboxValue(P.text.apply(this,[S]));this.refreshOptions(true)}T.preventDefault();return}}return Q.apply(this,arguments)}})()});return c}));